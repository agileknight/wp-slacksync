# Local Development Setup

## Generic Wordpress setup

The developer can chose any local wordpress setup he feels comfortable with.

## Using docker-compose

### Installation

<https://docs.docker.com/compose/install/>

### First time

Create new docker host instance on local machine:

`docker-machine create wpslacksync --driver virtualbox`

### Start local instance

Make sure docker host is running:

`docker-machine start wpslacksync`

Connect to docker host:

`eval $(docker-machine env wpslacksync)`

Generate self-signed test SSL certificates

`cd docker-wordpress/certs && ./generate.sh && cd ../../`

Start instance:

`docker-compose up -d`

To update the wordpress and database versions, run:

```
docker-compose pull
docker-compose stop
docker-compose rm -y
docker-compose up -d
```

### View page in browser

Find out IP address of docker host:

`docker-machine ls`

Add entry in /etc/hosts for that IP for domain *www.wpslacksynctest.com*

Example line:

`192.168.99.100 www.wpslacksynctest.com`

In browser, visit <http://www.wpslacksynctest.com>

## Initial wordpress setup

When visiting page after starting a fresh or updated version:

* Select language *English*
* Enter site title "WPSlackSync Test Local"
* Enter username, password and email (e.g. admin, admin [x] confirm weak password)
* Click *Install WordPress*


## Initial wordpress plugin setup

* Go to <http://www.wpslacksynctest.com/wp-admin/plugins.php> and log in using the chosen credentials
* Click *Activate* next to the WPSlackSync plugin
* Visit <http://www.wpslacksynctest.com/wp-admin/options-general.php?page=wpslacksync-settings>
* Follow the following instructions on to setup Slack test team and plugin settings

## Slack test team setup

1. Download the plugin zip

2. Add the plugin to your site by uploading it. Go to Plugins > Add New > Upload Plugin. Once wpslacksync-<version>.zip is uploaded, click Install Now.

3. It should automatically unpack and install. After the prompt that the plugin has installed successfully, choose Activate Plugin.

4. After activation, go to the Settings menu, and go to WP SlackSync.

6. Switch to the General tab if not open already. To fill in the App Client ID and App Client secret, it is necessary to create a Slack App for this first. By clicking on the Slack New Application link, you will be redirected to the apps website of slack (https://api.slack.com/apps). Click the Create New App button.

7. Enter an App Name and select the Slack workspace you want to synchronize the chat with in the Development Slack Workspace dropdown. Click Create App.

8. Navigate to Oauth & Permissions and enter your site domain name into the Redirect URLs. Click Add New Redirect URL, enter the URL in the field, and click Add. Click SaveURLs. It is not necessary to enter any subpaths for your site. Example: https://yoursite.com

9. On the Oauth & Permissions page, click Add an OAuth Scope under User Token Scopes. Select identify and add that scope. This is only necessary so we can install the app to the workspace. Click the Install App to Workspace at the top. Confirm the OAuth you are redirected to.

10. Navigate to Basic Information. Copy the Client ID and the Client Secret generated by Slack and paste these in the WP SlackSync settings General tab in your WordPress site. To view the client secret, click Show. Save the changes in WP SlackSync.

11. Click the Authorize with Slack link and confirm the OAuth screen you are redirected to. You should be directed back to the WP SlackSync settings and the field API Token should be filled with a token starting with “xoxp-“.

12. To verify your API Token, go to the Team Details tab and click the Auto Fill button. The Domain and ID should be filled in automatically. Save the changes.

13. Fill in the details under the Display tab. This will require the Team name that your members/users will see on your site. Save the changes.

14. Add the shortcode [wpslacksync] to a WordPress page and publish/preview it, checking that the plugin and its settings work as desired.

## Create test page

* Go to <http://www.wpslacksynctest.com/wp-admin/post.php?post=2&action=edit>
* Replace page contents with the "[wpslacksync]" shortcode
* Click *Update*
* Go to <http://www.wpslacksynctest.com/?page_id=2>

# Automated Tests

## JavaScript Unit Tests

### Run tests

Open SpecRunner.html in browser, tests run automatically.
